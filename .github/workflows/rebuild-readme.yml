name: Rebuild README

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  rebuild:
    runs-on: windows-latest

    steps:
    - name: Checkout public repo
      uses: actions/checkout@v4
      with:
        persist-credentials: true

    - name: Checkout private build repo
      uses: actions/checkout@v4
      with:
        repository: leofcshen/Leo_CI
        token: ${{ secrets.BUILD_REPO_TOKEN }}
        path: _build

    - name: Run README rebuild
      shell: pwsh
      run: |
        cd _build
        pwsh ./BeforeBuild.ps1

    - name: Commit README changes
      shell: pwsh
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"

        git add README.md README.zh-TW.md
        git diff --cached --quiet || git commit -m "chore: rebuild README"
        git push
